<div id="steps2">

    <div class="row p-lg-5">
        <!-- List cart -->
        <div class="col-12 col-sm-12 col-md-7 col-lg-12 border border-danger d-none">
            <!--Order Summary-->
            <div class="block order-summary" *ngIf="listCarts">
                <div class="block-content">
                    <h2 class="title mb-3 text-center fw-bold mb-5 mt-3 text-uppercase">Resumen del pedido</h2>
                    <div class="table-responsive table-bottom-brd order-table"> 
                        <table class="table table-hover align-middle mb-0">
                            <thead>
                                <tr>
                                    <th class="action">&nbsp;</th>
                                    <th class="text-start text-black">Imagen</th>
                                    <th class="text-start proName text-black">Product</th>
                                    <th class="text-center text-black">Cantidad</th>
                                    <th class="text-center text-black">Precio</th>
                                    <th class="text-center text-black">Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                <ng-container *ngFor="let cart of listCarts">
                                    <tr>
                                        <td class="text-center cart-delete"><a href="#" onclick="return false;" (click)="removeCart(cart)" class="btn btn-secondary cart-remove remove-icon position-static" data-bs-toggle="tooltip" data-bs-placement="top" title="Remove to Cart"><i class="icon anm anm-times-r"></i></a></td>
                                        <td class="text-start">
                                            <a href="product-layout1.html" class="thumb">
                                                <img class="rounded-0 blur-up lazyload" onclick="return false;" [routerLink]="['/landing-product', cart.product.slug]" [attr.data-src]="cart.product.imagen" [src]="cart.product.imagen" alt="product" title="product" width="120" height="170" />
                                            </a>
                                        </td>
                                        <td class="text-start proName">
                                            <div class="list-view-item-title">
                                                <a href="product-layout1.html" onclick="return false;" [routerLink]="['/landing-product', cart.product.slug]">{{cart.product.title}}</a>
                                            </div>
                                            <div class="cart-meta-text">
                                                Color: {{cart.variedad.color}}<br>Talla: {{cart.variedad.valor}}
                                            </div>
                                        </td>
                                        <td class="text-center">{{ cart.cantidad }}</td>

                                        <!-- <td class="text-center">{{ cart.subtotal | number: '1.2-2' }} {{ euro }}</td> -->
                                        <td class="text-center">
                                            <span class="price-small fw-normal">
                                                <span class="price-main-small">{{ getFormattedPrice(cart.subtotal).integerPart }}</span>
                                                <span class="price-decimals-small">
                                                    <sup>{{ getFormattedPrice(cart.subtotal).decimalPart }}</sup>
                                                    <span class="currency-symbol-small">{{ euro }}</span>
                                                </span>
                                            </span>
                                        </td>


                                        <!-- <td class="text-center"><strong>{{ cart.total | number: '1.2-2' }} {{ euro }}</strong></td> -->
                                        <td class="text-center">
                                            <span class="price-small">
                                                <span class="price-main-small">{{ getFormattedPrice(cart.total).integerPart }}</span>
                                                <span class="price-decimals-small">
                                                    <sup>{{ getFormattedPrice(cart.total).decimalPart }}</sup>
                                                    <span class="currency-symbol-small">{{ euro }}</span>
                                                </span>
                                            </span>
                                        </td>
                                    </tr>
                                </ng-container>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!--End Order Summary-->
        </div>
        <!-- Codigo de cupon y Total -->
        <div class="col-12 col-sm-12 col-md-5 col-lg-12 py-5 border border-success d-none">
            <div class="row justify-content-center">
                <div class="col-12 col-sm-12 col-md-5 col-lg-4">
                    <!--Apply Promocode-->
                    <div class="block mb-3 apply-code mb-4">
                        <div class="block-content">
                            <h3 class="title mb-3 text-uppercase">Aplicar código promocional</h3>
                            <div id="coupon" class="coupon-dec">
                                <p class="fw-light">Introduce tu código promocional y disfruta de grandes ahorros en tu compra.</p>
                                <div class="input-group mb-0 d-flex">
                                    <input id="coupon-code" [(ngModel)]="code_cupon" required="" type="text" class="form-control" placeholder="Código de promoción">
                                    <button class="coupon-btn btn btn-secondary fw-normal text-uppercase" (click)="apllyCupon()" [disabled]="loading" type="submit">
                                        <div *ngIf="loading" class="loading-spinner justify-content-center align-items-center">
                                            <div class="row">
                                                <div class="col-sm-2">
                                                    <div class="sp bg-white sp-bars"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <span *ngIf="!loading">Aplicar</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--End Apply Promocode-->
                </div>
                <div class="col-12 col-sm-12 col-md-5 col-lg-4">
                    <!--Cart Summary-->
                    
                    <div class="cart-info mb-4">
                        <h3 class="title mb-3 text-uppercase">Resumen de Precio</h3>
                        <div class="cart-order-detail cart-col">
                            
                            <div class="row g-0 border-bottom pb-2">
                                <span class="col-6 col-sm-6 cart-subtotal-title fw-light"><strong>Subtotal</strong></span>
                                <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end">
                                    <!-- <span class="money">{{ getFormattedPrice(totalCarts).integerPart }}.{{ getFormattedPrice(totalCarts).decimalPart }} {{ euro }}</span> -->
                                    <span class="money">
                                        <span class="price-small fw-normal">
                                            <span class="price-main-small">{{ getFormattedPrice(totalCarts).integerPart }}</span>
                                            <span class="price-decimals-small">
                                                <sup>{{ getFormattedPrice(totalCarts).decimalPart }}</sup>
                                                <span class="currency-symbol-small">{{ euro }}</span>
                                            </span>
                                        </span>
                                    </span>
                                </span>

                                <!-- <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end">
                                    <span class="money price">
                                        <span class="price-main">{{ getFormattedPrice(totalCarts).integerPart }}</span>
                                        <span class="price-decimals">
                                            <sup>{{ getFormattedPrice(totalCarts).decimalPart }}</sup>
                                            <span class="currency-symbol">{{ euro }}</span>
                                        </span>
                                    </span>
                                </span> -->
                            </div>
                            <div class="row g-0 border-bottom py-2 d-none">
                                <span class="col-6 col-sm-6 cart-subtotal-title"><strong>Coupon Discount</strong></span>
                                <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end"><span class="money">-$25.00</span></span>
                            </div>
                            <div class="row g-0 border-bottom py-2 d-none">
                                <span class="col-6 col-sm-6 cart-subtotal-title"><strong>Tax</strong></span>
                                <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end"><span class="money">$10.00</span></span>
                            </div>
                            <div class="row g-0 border-bottom py-2">
                                <span class="col-6 col-sm-6 cart-subtotal-title fw-light"><strong>Envío</strong></span>
                                <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end"><span class="money">Gratis</span></span>
                            </div>
                            <div class="row g-0 pt-2">
                                <span class="col-6 col-sm-6 cart-subtotal-title fs-5 text-uppercase"><strong>Total</strong></span>
                                <!-- <span class="col-6 col-sm-6 cart-subtotal-title fs-5 cart-subtotal text-end"><b class="money">{{ totalCarts | number: '1.2-2' }} {{ euro }}</b></span> -->
                                <span class="col-6 col-sm-6 cart-subtotal-title fs-5 cart-subtotal text-end">
                                    <span class="money price">
                                        <span class="price-main">{{ getFormattedPrice(totalCarts).integerPart }}</span>
                                        <span class="price-decimals">
                                            <sup>{{ getFormattedPrice(totalCarts).decimalPart }}</sup>
                                            <span class="currency-symbol">{{ euro }}</span>
                                        </span>
                                    </span>
                                </span>
                            </div>
                        </div>                               
                    </div>
                    <!--Cart Summary-->
                </div>
            </div>
        </div>
        <!-- / End Codigo de cupon y Total -->
        


        <!-- ------ NUEVA Estructura ------- -->
        
        <!-- ======== Columna de la izquierda ======== -->
        <div class="col-12 col-sm-12 col-md-7 col-lg-8">
            <!-- Tipo de envío -->
            <div class="mb-4">
                <h3 class="mb-0 text-uppercase mb-3">Tipo de envío</h3>
                <div class="d-flex flex-row mb-3">
                    <div class="p-3 border border-dark w-25 me-3">
                        <div class="d-flex flex-column justify-content-center">
                            <span class="text-center">
                                <svg width="24" height="24" aria-hidden="true" class="Icon_icon-content-1__kPDLF" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24.04 24.04"><g data-name="S"><path d="M21.8 11.2 21 9.6zM21 9.6l-.7-1.5z"></path><path d="M21 20h-2.5v-6H5v6H3v1h18Zm-10 0v-4h2v4ZM4.3 9.8l.7-.5V13h13.5V8.9l1.2.9.6-.8L12 2.9 9 5.1V3H6v4.3L3.7 9Zm6.6-2.4A2.1 2.1 0 0 1 12 7a1.54 1.54 0 0 1 1.5 1.5A1.54 1.54 0 0 1 12 10a2.1 2.1 0 0 1-1.1-.4 1.5 1.5 0 0 1-.4-1.1 1.5 1.5 0 0 1 .4-1.1"></path></g></svg>
                            </span>
                            <span class="text-center"> Domicilio </span>
                            <span class="text-center">GRATIS</span>
                        </div>
                    </div>
                    <div class="p-5 bg-warning d-none">
                        <div class="d-flex flex-column justify-content-center">
                            <span class="text-center">
                                <svg width="24" height="24" aria-hidden="true" class="Icon_icon-content-1__kPDLF" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 24 24"><path d="M17.603 5H21v15h-3v-9.337L15.521 15l-1.929-3 4.01-7zM3 5v15h3v-9.492L12.313 20 14 17 6 5z"></path></svg>
                            </span>
                            <span>Tienda</span>
                            <span class="texts_uppercaseL__dKrzo">GRATIS</span>
                        </div>
                    </div>
                    <div class="p-3 border border-muted w-25">
                        <div class="d-flex flex-column justify-content-center">
                            <span class="text-center">
                                <svg width="24" height="24" aria-hidden="true" class="Icon_icon-content-1__kPDLF" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 24 24"><path d="M12 2C9.355 2 6.875 3.542 5.682 5.929c-1.295 2.589-.724 5.925 1.511 8.909.072.105 4.391 6.585 4.391 6.585l.416.624.416-.624 4.377-6.567c2.25-3.002 2.82-6.338 1.525-8.927C17.125 3.542 14.645 2 12 2m3.999 12.25c-.016.02-.019.022-3.999 5.994-3.98-5.972-3.983-5.974-3.993-5.987-2.017-2.693-2.552-5.639-1.43-7.881C7.602 4.326 9.73 3 12 3s4.398 1.325 5.423 3.376c1.122 2.242.587 5.188-1.424 7.874M12 5C9.794 5 8 6.794 8 9s1.794 4 4 4 4-1.794 4-4-1.794-4-4-4m0 7c-1.654 0-3-1.346-3-3s1.346-3 3-3 3 1.346 3 3-1.346 3-3 3"></path></svg>
                            </span>
                            <span class="text-center">Punto de recogida</span>
                            <span class="text-center">GRATIS</span>
                        </div>
                    </div>
                </div>
                
            </div>

            <!-- Shipping rates -->
            <div class="d-flex flex-row mb-4">
                <p><span class="fw-bold me-2">Entrega:</span><time datetime="2025-4-9">viernes, 9 may</time> - <time datetime="2025-4-14">miércoles, 14 may</time></p>
            </div>

            <!--Address-->
            <div class="d-flex flex-row mb-4">
                <div class="dashboard-content h-100 w-100 mb-3" id="top-tabContent">
                    <!-- Address Book -->
                    <div class="tab-pane h-100 " id="address">
                        <div class="address-card mt-0 h-100">
                            <ng-container *ngIf="listAddresses.length == 0; else allShowListAddress">
                                <div class="d-flex justify-content-center align-items-center">
                                    <div class="p-2 text-center d-flex flex-column">
                                        <div class="inner mb-3 d-none">
                                            <div class="bradcrumb-thumb">
                                                <img src="assets/images/favicon.png" alt="Image" style="width: 50px; height: 50px;">
                                            </div>
                                        </div>
                                        <h5 class="header-title mb-0 text-uppercase">Libreta de direcciones</h5>
                                        <small class="mb-3">De momento ninguna dirección registrada</small>
                                        <a href="" onclick="return false;" [routerLink]="['/', locale, country, 'account', 'checkout', 'delivery']"> <button type="button" class="mt-3 btn btn-primary btn-lg px-5"> Añadir dirección</button></a>
                                    </div>
                                </div>
                            </ng-container>
                            <ng-template #allShowListAddress>
                                <!-- Spinner -->
                                <div *ngIf="loading" class="loading-spinner d-flex justify-content-center h-100 align-items-center">
                                    <div class="text-center">
                                        <div class="spinner-border text-muted" role="status">
                                        <span class="sr-only"></span>
                                        </div>
                                        <h4 class="text-muted">Cargando</h4>
                                    </div>
                                </div>
                                
                                <!-- Mostrar la lista de direcciones -->
                                <div class="address-book-section" [class.d-none]="loading">
                                    <div class="top-sec d-flex mb-3" [class.d-none]="loading">
                                        <h3 class="mb-0 text-uppercase">Datos de envío</h3>
                                    </div>
                                    
                                    <div class="row">
                                        <!-- Direcciones de usuarios autenticados -->
                                        <!-- <ng-container *ngFor="let list_address of listAddressClients; let i=index">
                                            <div class="address-select-box active">
                                                <div class="address-box bg-block">
                                                    <div class="top d-flex-justify-center justify-content-between">
                                                        <p class="m-0 text-uppercase">{{ list_address.name +' '+ list_address.surname }}</p>
                                                        <a href="#;" class="header-cart btn-minicart clr-none" data-bs-toggle="offcanvas" data-bs-target="#miniAddress-drawer">
                                                            <button type="button" class="bottom-btn btn btn-gray btn-sm">Editar</button>
                                                        </a>
                                                    </div>
                                                    <div class="middle">
                                                        <div class="address"><p class="fw-light"> {{ list_address.address }}</p></div>
                                                        <div class="address"><p class="fw-light"> {{ list_address.zipcode }} {{ list_address.poblacion }}, <span class="text-uppercase">{{ list_address.ciudad }}</span> <br/></p></div>
                                                        <div class="address"><p class="fw-light">Tel. +34 {{ list_address.phone }}</p></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container> -->

                                    
                                        <ng-container *ngIf="selectedAddress">
                                            <div class="address-select-box active">
                                                <div class="address-box bg-block">
                                                    <div class="top d-flex-justify-center justify-content-between">
                                                        <p class="m-0 text-uppercase">
                                                            {{ selectedAddress.name + ' ' + selectedAddress.surname }}
                                                        </p>
                                                        <!-- <button type="button" class="bottom-btn btn btn-gray btn-sm" (click)="addressClienteSelected(list_address)" data-bs-toggle="modal" data-bs-target="#addEditModal">Editar</button> -->
                                                        <a href="#;" class="header-cart btn-minicart clr-none" data-bs-toggle="offcanvas" data-bs-target="#miniAddress-drawer">
                                                            <button type="button" class="bottom-btn btn btn-gray btn-sm">Editar</button>
                                                        </a>
                                                    </div>
                                                    <div class="middle">
                                                        <div class="address"><p class="fw-light">{{ selectedAddress.address }}</p></div>
                                                        <div class="address">
                                                            <p class="fw-light">
                                                                {{ selectedAddress.zipcode }} {{ selectedAddress.poblacion }},
                                                                <span class="text-uppercase">{{ selectedAddress.ciudad }}</span><br/>
                                                            </p>
                                                        </div>
                                                        <div class="address">
                                                            <p class="fw-light">Tel. +34 {{ selectedAddress.phone }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                          

                                        <!-- Direcciones de usuarios invitados -->
                                         <div class="d-none">
                                            <ng-container *ngFor="let list_address of listAddressGuest; let i=index">
                                                <div class="address-select-box active">
                                                    <div class="address-box bg-block">
                                                        <div class="mb-3 d-flex flex-row">
                                                            <span class="d-flex flex-row">
                                                                <svg width="24" height="24" aria-hidden="true" class="Icon_icon-content-1__kPDLF" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 24 24">
                                                                    <path d="M19 20V9.3l.7.5.6-.8L12 2.9 9 5.1V3H6v4.3L3.7 9l.6.8.7-.5V20H3v1h18v-1zM7 4h1v1.8l-1 .8zM6 8.6l6-4.4 6 4.4V12H6zM11 20v-4h2v4zm-1-5v5H6v-7h12v7h-4v-5z"></path>
                                                                    <path d="M12 7c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 3c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1"></path>
                                                                </svg>
                                                            </span>
                                                            <span class="px-2">Domicilio</span>
                                                            <span class="">GRATIS</span>
                                                        </div>
                                                        <div class="top d-flex-justify-center justify-content-between mb-3">
                                                            <h5 class="m-0 fw-bold text-uppercase">{{ list_address.name +' '+ list_address.surname }}</h5>
                                                            <span class="product-labels start-auto end-0"><span class="lbl pr-label1">Casa</span></span>
                                                        </div>
                                                        <div class="middle">
                                                            <div class="address"><p class="fw-light"> {{ list_address.address }}</p></div>
                                                            <div class="address"><p class="fw-light"> {{ list_address.zipcode }} {{ list_address.poblacion }}, <span class="text-uppercase">{{ list_address.ciudad }}</span> <br/></p></div>
                                                            <div class="address"><p class="fw-light">Tel. {{ list_address.phone }}</p></div>
                                                            <div class="form-text px-2 mt-3 text-dark d-none" style="width: fit-content !important; background-color: #f3f3f3;">Dirección de envío habitual</div>
                                                        </div>
                                                        <div class="bottom d-flex-justify-center justify-content-between">
                                                            <button type="button" class="bottom-btn btn btn-gray btn-sm" (click)="addressClienteSelected(list_address)" data-bs-toggle="modal" data-bs-target="#addEditModal">Añadir o editar dirección</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </div>
                                        
                                    </div>
                                </div>
                            </ng-template>

                            <!-- Edit Address Modal -->
                            <div class="modal fade" id="addEditModal" tabindex="-1" aria-labelledby="addEditModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header justify-content-center border-0">
                                            <h2 class="modal-title text-uppercase" id="addNewModalLabel">Editar dirección</h2>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body border-0">
                                            <fieldset>
                                                <!-- Nombre -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="firstname" class="form-label d-none">Nombre <span class="required">*</span></label>
                                                        <input name="firstname" value="" id="firstname" type="text" [(ngModel)]="name" required="" placeholder="Nombre" class="form-control">
                                                    </div>
                                                </div>
                                                <!-- Apellidos -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="lastname" class="form-label d-none">Apellidos <span class="required">*</span></label>
                                                        <input name="lastname" value="" id="lastname" type="text" [(ngModel)]="surname" required="" placeholder="Aellidos" class="form-control">
                                                    </div>
                                                </div>
                                                <!-- Pais -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="address_country1" class="form-label d-none">País <span class="required">*</span></label>
                                                        <select id="address_country1" name="address[country]" [(ngModel)]="pais" data-default="United States" disabled class="form-control text-muted">
                                                            <option value="0" label="Seleccione un país" selected="selected">Seleccione un país</option>
                                                            <optgroup id="country-optgroup-Eu" label="Europe">
                                                                <option value="IT" label="Italy">Italy</option>
                                                                <option value="PT" label="Portugal">Portugal</option>
                                                                <option value="RO" label="Romania">Romania</option>
                                                                <option value="SPAIN" label="Spain">Spain</option>
                                                            </optgroup>
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- Direccion -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="address-1" class="form-label d-none">Dirección <span class="required">*</span></label>
                                                        <input name="address_1" value="" id="address-1" type="text" required="" [(ngModel)]="address" placeholder="Dirección" class="form-control">
                                                    </div>
                                                </div>
                                                <!-- Codigo postal -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="postcode" class="form-label d-none">Código postal <span class="required">*</span></label>
                                                        <input name="postcode" value="" id="postcode" type="text" class="form-control" [(ngModel)]="zipcode" placeholder="Código postal">
                                                    </div>
                                                </div>
                                                <!-- Población -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="new-city" class="form-label d-none">Población <span class="required">*</span></label>
                                                        <input name="city" placeholder="Población" value="" required="" [(ngModel)]="poblacion" id="new-city" type="text" />
                                                    </div>
                                                </div>  
                                                <!-- Ciudad -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="address_State" class="form-label d-none">Ciudad <span class="required">*</span></label>
                                                        <select id="address_State" name="address[State]" data-default="" [(ngModel)]="ciudad" class="form-control">
                                                            <option value="0" label="Select a state" selected="selected">Provincia/Estado</option>
                                                            <option value="Madrid">Madrid</option>
                                                            <option value="New York">New York</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- Email -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="email" class="form-label d-none">E-Mail <span class="required">*</span></label>
                                                        <input name="email" value="" id="email" type="email" required="" [(ngModel)]="email"  placeholder="E-mail" disabled class="form-control text-muted text-uppercase">
                                                    </div>
                                                </div>
                                                <!-- Telefono -->
                                                <div class="row justify-content-center">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <label for="phone" class="form-label d-none">Móvil <span class="required">*</span></label>
                                                        <input name="phone" value="" id="phone" type="tel" required="" [(ngModel)]="phone"  placeholder="Móvil" class="form-control">
                                                    </div>
                                                </div>
        
                                                <div class="row justify-content-center mt-0 mb-3">
                                                    <div class="form-group col-12 col-sm-6 col-md-6 col-lg-8">
                                                        <p class="mt-3">Dirección de envío habitual</p> 
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                        <div class="modal-footer border-0 justify-content-center">
                                            <div class="form-row row-cols-lg-1 row-cols-md-2 row-cols-sm-1 row-cols-1 text-center">
                                                <div class="form-group">
                                                    <button type="submit" class="btn btn-primary text-uppercase fw-normal btn-lg" (click)="storeAddress()">
                                                        <span>Guardar cambios</span>
                                                    </button>
                                                    <!-- <p class="mt-3" [ngClass]="status ? 'text-success' : 'text-danger'" *ngIf="this.validMessage && !status">{{ this.errorOrSuccessMessage }}</p>  -->
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Edit Address Modal -->
                        </div>
                    </div>
                    <!-- End Address Book -->
                </div>
            </div>

            <!-- Boton continuar a pago -->
            <div class="d-flex flex-column">
                <button type="button" class="btn btn-primary px-5 py-3 text-uppercase fw-normal btnNext w-50" (click)="goToNextStep()">Continuar a pago</button>
                <p id="" class="fs-12">
                    <small class="text-muted">Al continuar, confirmas que has leído la <a class="text-black fw-bold" href="/es/es" data-testid="checkout.step1.legalpolicy.link" target="" aria-labelledby="checkout.step1.legalpolicy" aria-expanded="false">Política de privacidad</a></small>
                </p>
            </div>
        </div>

        <!-- ======== Columna de la derecha ======== -->
        <div class="col-12 col-sm-12 col-md-5 col-lg-4">
            <h3 class="title mb-0 text-uppercase mb-3">Pedido</h3>

            <!-- Código promocional -->
            <div class="mb-3 payment-methods mb-4">
                <div class="block-content">
                    <div class="payment-accordion-radio">
                        <div class="accordion" id="accordionExample">
                            <div class="accordion-item card mb-2 px-3 border border-muted">
                                <div class="card-header p-3" id="headingTwo">
                                    <button class="card-link" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        <span class="customRadio clearfix mb-0">
                                            <input id="paymentRadio2" value="" name="payment" type="radio" class="radio" /> 
                                            <label for="paymentRadio2" class="mb-0 fw-bold text-uppercase">Código promocional</label>
                                        </span>
                                    </button>
                                </div>
                                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                                    <div class="card-body px-0">
                                        <p>Introduce tu código promocional y disfruta de grandes ahorros en tu compra.</p>
                                        <div class="input-group mb-0 d-flex">
                                            <input id="coupon-code" [(ngModel)]="code_cupon" required="" type="text" class="form-control" placeholder="Código de promoción">
                                            <button class="coupon-btn btn btn-secondary fw-normal text-uppercase" (click)="apllyCupon()" [disabled]="loading" type="submit">
                                                <div *ngIf="loading" class="loading-spinner justify-content-center align-items-center">
                                                    <div class="row">
                                                        <div class="col-sm-2">
                                                            <div class="sp bg-white sp-bars"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <span *ngIf="!loading">Aplicar</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Apply Promocode-->
            <div class="block mb-3 apply-code mb-4 p-0 d-none">
                <div class="block-content">
                    <h3 class="title mb-3 text-uppercase">Aplicar código promocional</h3>
                    <div id="coupon" class="coupon-dec">
                        <p class="fw-light">Introduce tu código promocional y disfruta de grandes ahorros en tu compra.</p>
                        <div class="input-group mb-0 d-flex">
                            <input id="coupon-code" [(ngModel)]="code_cupon" required="" type="text" class="form-control" placeholder="Código de promoción">
                            <button class="coupon-btn btn btn-secondary fw-normal text-uppercase" (click)="apllyCupon()" [disabled]="loading" type="submit">
                                <div *ngIf="loading" class="loading-spinner justify-content-center align-items-center">
                                    <div class="row">
                                        <div class="col-sm-2">
                                            <div class="sp bg-white sp-bars"></div>
                                        </div>
                                    </div>
                                </div>
                                <span *ngIf="!loading">Aplicar</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!--Cart Summary-->      
            <div class="cart-info mb-4">
                <h3 class="title mb-3 text-uppercase">Resumen de Precio</h3>
                <div class="cart-order-detail cart-col">
                    
                    <div class="row g-0 border-bottom pb-2">
                        <span class="col-6 col-sm-6 cart-subtotal-title fw-light"><strong>Subtotal</strong></span>
                        <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end">
                            <!-- <span class="money">{{ getFormattedPrice(totalCarts).integerPart }}.{{ getFormattedPrice(totalCarts).decimalPart }} {{ euro }}</span> -->
                            <span class="money">
                                <span class="price-small fw-normal">
                                    <span class="price-main-small">{{ getFormattedPrice(totalCarts).integerPart }}</span>
                                    <span class="price-decimals-small">
                                        <sup>{{ getFormattedPrice(totalCarts).decimalPart }}</sup>
                                        <span class="currency-symbol-small">{{ euro }}</span>
                                    </span>
                                </span>
                            </span>
                        </span>

                        <!-- <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end">
                            <span class="money price">
                                <span class="price-main">{{ getFormattedPrice(totalCarts).integerPart }}</span>
                                <span class="price-decimals">
                                    <sup>{{ getFormattedPrice(totalCarts).decimalPart }}</sup>
                                    <span class="currency-symbol">{{ euro }}</span>
                                </span>
                            </span>
                        </span> -->
                    </div>
                    <div class="row g-0 border-bottom py-2 d-none">
                        <span class="col-6 col-sm-6 cart-subtotal-title"><strong>Coupon Discount</strong></span>
                        <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end"><span class="money">-$25.00</span></span>
                    </div>
                    <div class="row g-0 border-bottom py-2 d-none">
                        <span class="col-6 col-sm-6 cart-subtotal-title"><strong>Tax</strong></span>
                        <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end"><span class="money">$10.00</span></span>
                    </div>
                    <div class="row g-0 border-bottom py-2">
                        <span class="col-6 col-sm-6 cart-subtotal-title fw-light"><strong>Envío</strong></span>
                        <span class="col-6 col-sm-6 cart-subtotal-title cart-subtotal text-end"><span class="money">Gratis</span></span>
                    </div>
                    <div class="row g-0 pt-2">
                        <span class="col-6 col-sm-6 cart-subtotal-title fs-5 text-uppercase"><strong>Total</strong></span>
                        <!-- <span class="col-6 col-sm-6 cart-subtotal-title fs-5 cart-subtotal text-end"><b class="money">{{ totalCarts | number: '1.2-2' }} {{ euro }}</b></span> -->
                        <span class="col-6 col-sm-6 cart-subtotal-title fs-5 cart-subtotal text-end">
                            <span class="money price">
                                <span class="price-main">{{ getFormattedPrice(totalCarts).integerPart }}</span>
                                <span class="price-decimals">
                                    <sup>{{ getFormattedPrice(totalCarts).decimalPart }}</sup>
                                    <span class="currency-symbol">{{ euro }}</span>
                                </span>
                            </span>
                        </span>
                    </div>
                </div>                               
            </div>

            <!-- Carts -->
            <div class="row">
                <div class="col-12 col-sm-12 col-md-7 col-lg-12">
                  <!-- Order Summary -->
                  <div class="block order-summary p-0">
                    
                    <div class="block-content">
                        <h3 class="mb-0">Artículos ({{ listCarts.length }})</h3>
                      <div class="order-list">
                        <ng-container *ngFor="let cart of listCarts">
                          <div class="d-flex border-bottom py-3 align-items-start gap-3 flex-wrap">
                            <!-- Imagen -->
                            <div style="flex: 0 0 auto;">
                              <a [routerLink]="['/landing-product', cart.product.slug]">
                                <img
                                  [src]="cart.product.imagen"
                                  alt="product"
                                  title="Product"
                                  style="width: auto; height: 160px; object-fit: cover;"
                                  class="img-fluid"
                                />
                              </a>
                            </div>
              
                            <!-- Info del producto -->
                            <div class="flex-grow-1 d-flex flex-column justify-content-between">
                                <!-- Línea superior: título y precio alineados -->
                                <div class="d-flex justify-content-between align-items-start flex-wrap">
                                <h5 class="mb-1 me-2">
                                    <a [routerLink]="['/landing-product', cart.product.slug]" class="text-decoration-none text-dark">
                                    {{ cart.product.title }}
                                    </a>
                                </h5>
                                <div class="fw-bold text-end">
                                    <span class="price-small fw-bold">
                                    <span class="price-main-small">{{ getFormattedPrice(cart.total).integerPart }}</span>
                                    <span class="price-decimals-small">
                                        <sup>{{ getFormattedPrice(cart.total).decimalPart }}</sup>
                                        <span class="currency-symbol-small">{{ euro }}</span>
                                    </span>
                                    </span>
                                </div>
                                </div>
                            
                                <!-- Datos adicionales -->
                                <div class="mt-2">
                                <p class="mb-1 small">Color: {{ cart.variedad.color }}</p>
                                <p class="mb-1 small">Talla: {{ cart.variedad.valor }}</p>
                                <p class="mb-1 small">Cantidad: {{ cart.cantidad }}</p>
                                </div>
                            
                                <!-- Subtotal -->
                                <div class="mt-2 d-none">
                                    <div class="fw-bold">
                                        Subtotal:
                                        <span class="price-small">
                                        <span class="price-main-small">{{ getFormattedPrice(cart.total).integerPart }}</span>
                                        <span class="price-decimals-small">
                                            <sup>{{ getFormattedPrice(cart.total).decimalPart }}</sup>
                                            <span class="currency-symbol-small">{{ euro }}</span>
                                        </span>
                                        </span>
                                    </div>
                                </div>
                            </div>
  
              
                            <!-- Botón eliminar -->
                            <div style="flex: 0 0 auto;">
                              <a
                                href="#"
                                onclick="return false;"
                                (click)="removeCart(cart)"
                                class="btn btn-secondary cart-remove remove-icon"
                                data-bs-toggle="tooltip"
                                data-bs-placement="top"
                                title="Eliminar del carrito"
                              >
                                <i class="icon anm anm-times-r"></i>
                              </a>
                            </div>
                          </div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                  <!-- End Order Summary -->
                </div>
            </div>
   
        </div>

    </div>
    <div class="d-flex justify-content-center py-5 d-none">
        <!-- <button type="button" class="btn btn-secondary me-1 btnPrevious">Volver</button> -->
        <button type="button" class="btn btn-primary ms-1 px-5 py-3 text-uppercase fw-normal btnNext" (click)="goToNextStep()">Continuar</button>
    </div>
</div>


<!--MiniCart Drawer-->
<div id="miniAddress-drawer" class="minicart-right-drawer offcanvas offcanvas-end" tabindex="-1">
    <!--MiniCart Empty-->
    <div id="cartEmpty" class="cartEmpty d-flex-justify-center flex-column text-center p-3 text-muted d-none">
        <div class="minicart-header d-flex-center justify-content-between w-100">
            <h4 class="fs-6">Your cart (0 Items)</h4>
            <button class="close-cart border-0" data-bs-dismiss="offcanvas" aria-label="Close"><i class="icon anm anm-times-r" data-bs-toggle="tooltip" data-bs-placement="left" title="Close"></i></button>
        </div>
        <div class="cartEmpty-content mt-4">
            <i class="icon anm anm-cart-l fs-1 text-muted"></i> 
            <p class="my-3">No Products in the Cart</p>
            <a href="index.html" class="btn btn-primary cart-btn">Continue shopping</a>
        </div>
    </div>
    <!--End MiniCart Empty-->

    <!--MiniCart Content-->
    <div id="cart-drawer" class="block block-cart" *ngIf="listCarts">
        <div class="minicart-header">
            <button class="close-cart border-0" data-bs-dismiss="offcanvas" aria-label="Close"><i class="icon anm anm-times-r" data-bs-toggle="tooltip" data-bs-placement="left" title="Close"></i></button>
            <h4 class="fs-6 text-uppercase fw-bold">Dirección de envío ({{ listAddresses.length }})</h4>
        </div>
        <div class="minicart-content d-flex">
            <ng-container *ngIf="listCarts.length == 0; else allCarts">
                <div class="d-flex align-items-center">
                    <div class="p-2 w-100 d-flex flex-column justify-content-center text-center">
                        <div class="inner mb-3 d-none">
                            <div class="bradcrumb-thumb">
                                <img src="assets/images/favicon.png" alt="Image" style="width: 50px; height: 50px;">
                            </div>
                        </div>
                        <h5 class="header-title mb-0 text-uppercase">¡Oops! Tu carrito está vacío</h5>
                        <p>Empieza a llenarlo con cosas que te encantarán.</p>
                    </div>
               </div>
            </ng-container>
            <ng-template #allCarts>
                <ul class="m-0 clearfix w-100">
                    <ng-container *ngFor="let list_address of listAddresses; let i=index">
                        
                        <div class="payment-accordion-radio">
                            <div class="accordion" id="accordionExample">
                                <div class="accordion-item card mb-2 p-3">
                                    <div class="card-header" [id]="'heading' + i">
                                        <div class="d-flex flex-row justify-content-between">
                                            <div>
                                                <div class="card-link">
                                                    <span class="customRadio clearfix mb-0">
                                                      <input 
                                                        id="paymentRadio{{i}}" 
                                                        [value]="list_address.id" 
                                                        name="payment" 
                                                        type="radio" 
                                                        class="radio" 
                                                        [(ngModel)]="selectedAddressId" 
                                                        (change)="onAddressChange(list_address.id)" 
                                                      />
                                                      <label for="paymentRadio{{i}}" class="mb-0 text-uppercase fw-bold">
                                                        {{ list_address.name + ' ' + list_address.surname }}
                                                      </label>
                                                    </span>
                                                  </div>
                                            </div>
                                            <div>
                                                <a href="#" onclick="return false;" (click)="addressClienteSelected(list_address)">
                                                    <button type="button" class="border-0 fw-bold text-decoration-underline"  data-bs-toggle="modal" data-bs-target="#addEditModal">Editar</button> 
                                                </a>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    <p class="text-danger">selectedAddressId = {{ selectedAddressId }}</p>
                                    <p class="text-primary">list_address.id  = {{ list_address.id }}</p>
                                    <div 
                                        [id]="'collapse' + i" 
                                        class="accordion-collapse collapse show" 
                                        aria-labelledby="'heading' + i" 
                                        data-bs-parent="#accordionExample">
                                        <div class="card-body p-0">
                                            <p class="fw-light mb-0"> {{ list_address.address }}</p>
                                            <p class="fw-light mb-0"> {{ list_address.zipcode }} {{ list_address.poblacion }}, <span class="text-uppercase">{{ list_address.ciudad }}</span> <br/></p>
                                            <p class="fw-light mb-0">Tel. +34 {{ list_address.phone }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                            
                    </ng-container> 


                    <!-- <ng-container *ngFor="let cart of listCarts">
                        <li class="item d-flex flex-column"> 
                            <div class="d-flex flex-row mb-2">
                                <div class="">
                                    <a class="product-image rounded-3" href="#" onclick="return false;" [routerLink]="['/', country, locale, 'shop', 'product', cart.product.slug]">
                                        <img class="blur-up lazyload"
                                        [src]="cart.product.imagen"
                                        alt="{{ cart.product.title }}"
                                        title="{{ cart.product.title }}"
                                        width="200"
                                        height="200" />
                                    </a>
                                </div>
                                <div class="d-flex w-100">
                                    <div class="product-details">
                                        <div class="priceRow mb-2">
                                            <div class="product-price d-flex flex-row justify-content-between">
                                                <a class="product-title text-uppercase fw-bold" href="#" onclick="return false;" [routerLink]="['/', country, locale, 'shop', 'product', cart.product.slug]">{{ cart.product.title }}</a>
                                                <span class="price-small fw-normal">
                                                    <span class="price-main-small">{{ getFormattedPrice(cart.total).integerPart }}</span>
                                                    <span class="price-decimals-small" style="top: 0.2em !important;">
                                                        <sup>{{ getFormattedPrice(cart.total).decimalPart }}</sup>
                                                        <span class="currency-symbol-small">{{ euro }}</span>
                                                    </span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="variant-cart mb-3" *ngIf="cart.variedad">{{ cart.variedad.color }} / {{ cart.variedad.valor }}</div>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex flex-row">
                                <div class="me-3">
                                    <a href="#" class="remove fw-light" onclick="return false;" (click)="removeCart(cart)"><i class="icon anm anm-times-r" data-bs-toggle="tooltip" data-bs-placement="top" title="Eliminar"></i> Eliminar</a>
                                </div>
                                <div class="">
                                    <a href="#" class="remove fw-light" onclick="return false;"><i class="icon anm anm-heart-l" data-bs-toggle="tooltip" data-bs-placement="top" title="Favorito"></i> Comprar mas tarde</a>
                                </div>
                            </div>
                        </li>
                    </ng-container> -->
                    
                </ul>
            </ng-template>
        </div>
        <div class="minicart-bottom" *ngIf="listAddressClients.length != 0">
            <div class="minicart-action d-flex flex-column mt-3">
                <!-- <a [href]="'/' + locale + '/' + country + '/shop/cart'" class="cart-btn btn btn-outline-black w-100 me-1 btn-lg text-uppercase fw-normal py-3 mb-3">Confirmar dirección</a> -->
                <button 
                class="cart-btn btn btn-outline-black w-100 me-1 btn-lg text-uppercase fw-normal py-3 mb-3"
                (click)="confirmarDireccion()"
              >
                Confirmar dirección
              </button>
              
                <a [href]="'/' + locale + '/' + country + '/shop/cart'" class="cart-btn btn btn-outline-white text-black bg-white w-100 me-1 btn-lg text-uppercase fw-normal py-3 mb-3">Añadir otra dirección</a>
            </div>
        </div>
    </div>
    <!--MiniCart Content-->
</div>
<!--End MiniCart Drawer-->